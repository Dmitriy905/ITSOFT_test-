function email_test(input) {
  return !/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,8})+$/.test(input.value);
}

//BildSlider
let sliders = document.querySelectorAll('._swiper');
if (sliders) {
	for (let index = 0; index < sliders.length; index++) {
		let slider = sliders[index];
		if (!slider.classList.contains('swiper-bild')) {
			let slider_items = slider.children;
			if (slider_items) {
				for (let index = 0; index < slider_items.length; index++) {
					let el = slider_items[index];
					el.classList.add('swiper-slide');
				}
			}
			let slider_content = slider.innerHTML;
			let slider_wrapper = document.createElement('div');
			slider_wrapper.classList.add('swiper-wrapper');
			slider_wrapper.innerHTML = slider_content;
			slider.innerHTML = '';
			slider.appendChild(slider_wrapper);
			slider.classList.add('swiper-bild');

			if (slider.classList.contains('_swiper_scroll')) {
				let sliderScroll = document.createElement('div');
				sliderScroll.classList.add('swiper-scrollbar');
				slider.appendChild(sliderScroll);
			}
		}
		if (slider.classList.contains('_gallery')) {
			//slider.data('lightGallery').destroy(true);
		}
	}
	sliders_bild_callback();
}

function sliders_bild_callback(params) { }

let sliderScrollItems = document.querySelectorAll('._swiper_scroll');
if (sliderScrollItems.length > 0) {
	for (let index = 0; index < sliderScrollItems.length; index++) {
		const sliderScrollItem = sliderScrollItems[index];
		const sliderScrollBar = sliderScrollItem.querySelector('.swiper-scrollbar');
		const sliderScroll = new Swiper(sliderScrollItem, {
			observer: true,
			observeParents: true,
			direction: 'vertical',
			slidesPerView: 'auto',
			freeMode: true,
			scrollbar: {
				el: sliderScrollBar,
				draggable: true,
				snapOnRelease: false
			},
			mousewheel: {
				releaseOnEdges: true,
			},
		});
		sliderScroll.scrollbar.updateSize();
	}
}


function sliders_bild_callback(params) { }

let opinion = new Swiper('.opinion__slider', {
	observer: true,
	observeParents: true,
	slidesPerView: 1,
	spaceBetween: 30,
    speed: 800,
    loop: true,
    effect: 'fade',
    fadeEffect:{
      crossFade:true,
    },
    autoplay:{
        delay: 2000,
        disableOnInteraction:true,
    },
     pagination: {
		el: '.swiper-pagination',
         clickable: true,
	},
});


var pageSlider = new Swiper('.page__slider', {
    slidesPerView: 'auto',
    loop: true,
    centeredSlides: true,
    slideToClickedSlide: true,
    effect: "coverflow",
    spaceBetween: 150,
    grabCursor: true,
    autoplay: false,
    allowTouchMove: false,
    coverflow: {
        rotate: 0,
        stretch: 100,
        depth: 200,
        modifier: 1,
        slideShadows: false
    },
    navigation: {
        nextEl: '.swiper-button-next',
        prevEl: '.swiper-button-prev',
    },
    breakpoints: {
        767: {
            spaceBetween: 0,
        }
    }
});

let ua = window.navigator.userAgent;
const msie = ua.indexOf('MSIE ');
var isMobile = {
  Android() { return navigator.userAgent.match(/Android/i); }, BlackBerry() { return navigator.userAgent.match(/BlackBerry/i); }, iOS() { return navigator.userAgent.match(/iPhone|iPad|iPod/i); }, Opera() { return navigator.userAgent.match(/Opera Mini/i); }, Windows() { return navigator.userAgent.match(/IEMobile/i); }, any() { return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows()); },
};
function isIE() {
  ua = navigator.userAgent;
  const is_ie = ua.indexOf('MSIE ') > -1 || ua.indexOf('Trident/') > -1;
  return is_ie;
}
if (isIE()) {
  document.querySelector('html').classList.add('ie');
}
if (isMobile.any()) {
  document.querySelector('html').classList.add('_touch');
}

// Получить цифры из строки
// parseInt(itemContactpagePhone.replace(/[^\d]/g, ''))

function testWebP(callback) {
  const webP = new Image();
  webP.onload = webP.onerror = function () {
    callback(webP.height == 2);
  };
  webP.src = 'data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA';
}
testWebP((support) => {
  if (support === true) {
    document.querySelector('html').classList.add('_webp');
  } else {
    document.querySelector('html').classList.add('_no-webp');
  }
});

window.addEventListener('load', () => {
  if (document.querySelector('.wrapper')) {
    setTimeout(() => {
      document.querySelector('.wrapper').classList.add('_loaded');
    }, 0);
  }
});

let unlock = true;

//= ================
// ActionsOnHash
if (location.hash) {
  const hsh = location.hash.replace('#', '');
  if (document.querySelector(`.popup_${hsh}`)) {
    popup_open(hsh);
  } else if (document.querySelector(`div.${hsh}`)) {
    _goto(document.querySelector(`.${hsh}`), 500, '');
  }
}
//= ================
// Menu
const iconMenu = document.querySelector('.icon-menu');
if (iconMenu != null) {
  const delay = 500;
  const menuBody = document.querySelector('.menu__body');
  const bgcHeader = document.querySelector('.header');
  iconMenu.addEventListener('click', (e) => {
    if (unlock) {
      body_lock(delay);
      iconMenu.classList.toggle('_active');
      menuBody.classList.toggle('_active');
      bgcHeader.classList.toggle('_active');
    }
  });
}
//= ================
// BodyLock
function body_lock(delay) {
  const body = document.querySelector('body');
  if (body.classList.contains('_lock')) {
    body_lock_remove(delay);
  } else {
    body_lock_add(delay);
  }
}
function body_lock_remove(delay) {
  const body = document.querySelector('body');
  if (unlock) {
    const lock_padding = document.querySelectorAll('._lp');
    setTimeout(() => {
      for (let index = 0; index < lock_padding.length; index++) {
        const el = lock_padding[index];
        el.style.paddingRight = '0px';
      }
      body.style.paddingRight = '0px';
      body.classList.remove('_lock');
    }, delay);

    unlock = false;
    setTimeout(() => {
      unlock = true;
    }, delay);
  }
}
function body_lock_add(delay) {
  const body = document.querySelector('body');
  if (unlock) {
    const lock_padding = document.querySelectorAll('._lp');
    for (let index = 0; index < lock_padding.length; index++) {
      const el = lock_padding[index];
      el.style.paddingRight = `${window.innerWidth - document.querySelector('.wrapper').offsetWidth}px`;
    }
    body.style.paddingRight = `${window.innerWidth - document.querySelector('.wrapper').offsetWidth}px`;
    body.classList.add('_lock');

    unlock = false;
    setTimeout(() => {
      unlock = true;
    }, delay);
  }
}

//= ================
// Popups
const popup_link = document.querySelectorAll('._popup-link');
const popups = document.querySelectorAll('.popup');
for (let index = 0; index < popup_link.length; index++) {
  const el = popup_link[index];
  el.addEventListener('click', (e) => {
    if (unlock) {
      const item = el.getAttribute('href').replace('#', '');
      const video = el.getAttribute('data-video');
      popup_open(item, video);
    }
    e.preventDefault();
  });
}
for (let index = 0; index < popups.length; index++) {
  const popup = popups[index];
  popup.addEventListener('click', (e) => {
    if (!e.target.closest('.popup__body')) {
      popup_close(e.target.closest('.popup'));
    }
  });
}
function popup_open(item, video = '') {
  const activePopup = document.querySelectorAll('.popup._active');
  if (activePopup.length > 0) {
    popup_close('', false);
  }
  const curent_popup = document.querySelector(`.popup_${item}`);
  if (curent_popup && unlock) {
    if (video != '' && video != null) {
      const popup_video = document.querySelector('.popup_video');
      popup_video.querySelector('.popup__video').innerHTML = `<iframe src="https://www.youtube.com/embed/${video}?autoplay=1"  allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
    }
    if (!document.querySelector('.menu__body._active')) {
      body_lock_add(500);
    }
    curent_popup.classList.add('_active');
    history.pushState('', '', `#${item}`);
  }
}
function popup_close(item, bodyUnlock = true) {
  if (unlock) {
    if (!item) {
      for (let index = 0; index < popups.length; index++) {
        const popup = popups[index];
        const video = popup.querySelector('.popup__video');
        if (video) {
          video.innerHTML = '';
        }
        popup.classList.remove('_active');
      }
    } else {
      const video = item.querySelector('.popup__video');
      if (video) {
        video.innerHTML = '';
      }
      item.classList.remove('_active');
    }
    if (!document.querySelector('.menu__body._active') && bodyUnlock) {
      body_lock_remove(500);
    }
    history.pushState('', '', window.location.href.split('#')[0]);
  }
}
const popup_close_icon = document.querySelectorAll('.popup__close,._popup-close');
if (popup_close_icon) {
  for (let index = 0; index < popup_close_icon.length; index++) {
    const el = popup_close_icon[index];
    el.addEventListener('click', () => {
      popup_close(el.closest('.popup'));
    });
  }
}
document.addEventListener('keydown', (e) => {
  if (e.code === 'Escape') {
    popup_close();
  }
});



// Активирует close
document.querySelector('.disclaimer-close').addEventListener('click', function() {
    document.querySelector('.disclaimer').classList.add("_active");
  })


// Эффект волны
  class WaveGlitch {
    constructor({
        id,
        src,
        waveAmplitude = 30,
        intensity = 5,
        speed = 0.002,
      }) {
      this.id            = id
      this.src           = src
      this.waveAmplitude = waveAmplitude
      this.intensity     = intensity
      this.speed         = speed
      
      this.requestAnim = null
      this.ctx    = null
      this.image  = null
    
      this.width  = window.innerWidth
      this.height = window.innerHeight
      this.centerWindowX = null
      this.centerWindowY = null
      
      this.init()
    }
    
    init = () => {
      this.#createCanvas()
      this.#createImage()
      
      this.image.addEventListener('load', () => {
        this.centerWindowX = (window.innerWidth / 2) - this.image.width / 2
        this.centerWindowY = (window.innerHeight / 2) - this.image.height / 2
        this.#createAnimation()
      })
    }
  
    #createCanvas = () => {
      const canvas = document.createElement('canvas')
      this.ctx     = canvas.getContext('2d')
      
      canvas.id = this.id
      canvas.classList.add('canvas')
      canvas.setAttribute('width', `${ this.width }`)
      canvas.setAttribute('height', `${ this.height }`)
      
      document.body.append(canvas)
    }
    
    #createImage = () => {
      this.image = new Image()
      this.image.src = this.src
    }
    
    #createAnimation = () => {
      const imgSlice = this.width / 1
      const imgSliceWidth = 5
      
      this.speed += 0.02
      this.ctx.clearRect(0, 0, this.width, this.height)
    
      for (let i = 0; i <= imgSlice; i++) {
        this.ctx.drawImage(
          this.image,
    
          -this.centerWindowX + (i * imgSliceWidth),
          -this.centerWindowY - (Math.sin(this.speed - (i / this.waveAmplitude)) * this.intensity),
          imgSliceWidth,
          this.height,
  
          i * imgSliceWidth,
          0,
          imgSliceWidth,
          this.height,
        )
      }
      
      this.requestAnim = requestAnimationFrame(this.#createAnimation)
    }
  }
  
  new WaveGlitch({
    id       : 'canvas',
    src      : 'img/decor01.jpg',
    speed    : 0.001,
  })
  
  



  


